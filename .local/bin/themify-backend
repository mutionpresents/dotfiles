#!/bin/bash

# Check if the user provided an argument
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <path_to_image>"
    exit 1
fi

IMAGE="$1"

# Send notification to the user
notify-send "Changing Theme" "Applying new wallpaper and updating colors, please wait until confirmation..."

# Set wallpaper
swww img "$IMAGE" --transition-type center --transition-fps 60
#sleep 3

# Use wallust to generate colors and apply templates
if ! wallust run "$IMAGE"; then
    notify-send "Wallust Failed" "Trying fallback methods..."
    # Fallback: Try different backend
    if ! wallust run "$IMAGE" --backend thumb; then
        notify-send "Error" "Could not generate colors from this image"
        exit 1
    fi
fi



# Reload kitty
pkill -USR1 kitty 2>/dev/null

# Make nvim use colorscheme colors
# Not configured yet (set up later)
#python3 /home/user0/.config/nvim/pywal/chadwal.py

# Refresh Waybar
pkill waybar
sleep 1
waybar > /dev/null 2>&1 &

# Refresh swaync
pkill swaync
sleep 1 # Wait for swaync to fully close
swaync > /dev/null 2>&1 &

notify-send "Theme Applied" "Wallpaper and theme updated successfully!"
