#!/bin/bash
# Directory containing wallpapers
WALL_DIR="$HOME/Pictures/Wallpapers"

# Current directory (to cd back to)
CWD="$(pwd)"
cd "$WALL_DIR" || exit

# Handle spaces in filenames
IFS=$'\n'

# Grab the user-selected wallpaper with previews
#SELECTED_WALL=$(for a in *.jpg *.png; do echo -e "$a\x1ficon\x1f$WALL_DIR/$a" done | wofi --dmenu --prompt "Choose a wallpaper" --show dmenu)
#SELECTED_WALL=$(for a in *.jpg *.png; do echo -en "$a\0icon\x1f$a\n"; done | rofi -dmenu -p "Choose a wallpaper" --show dmenu)
SELECTED_WALL=$(for a in *.jpg *.png; do echo -en "$a\x00icon\x1f$WALL_DIR/$a\n"; done | rofi -dmenu -p "Choose a wallpaper" -show-icons)

# If not empty, pass to themify-backend
if [ -n "$SELECTED_WALL" ]; then
    # Extract just the filename without path (in case Wofi returns full path)
    WALLPAPER_FILE=$(basename "$SELECTED_WALL")
    themify-backend "$WALL_DIR/$WALLPAPER_FILE"
	ln -sf ~/.cache/wal/colors-kitty.conf ~/.config/kitty/colors.conf

	#swww img "$WALL_DIR/$WALLPAPER_FILE" --transition-type wipe --transition-duration 1.0 --transition-step 2.0
fi

# Go back to where you came from
cd "$CWD" || exit
